generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                     Int        @id @unique @default(autoincrement())
  fullname               String     @db.VarChar(255)
  username               String?    @db.VarChar(255)
  email                  String     @db.VarChar(255)
  password               String     @db.VarChar(255)
  avatar                 String?    @db.VarChar(255)
  country_code           String?    @db.VarChar(255)
  phone                  String?    @db.VarChar(255)
  role                   Role       @default(USER)
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @updatedAt
  status                 UserStatus @default(INACTIVE)
  updatePasswordAt       DateTime?
  dms                    DMs[]
  otps                   OTP[]
  sentFriendRequests     friends[]  @relation("SentFriendRequests")
  receivedFriendRequests friends[]  @relation("ReceivedFriendRequests")
  friends                friends[]

  @@index([id, status, role])
}

model OTP {
  id         Int       @id @unique @default(autoincrement())
  code       String    @db.VarChar(255)
  user_id    Int
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  email_id   String?   @db.VarChar(255)
  site_id    String    @db.VarChar(255)
  expiresAt  DateTime?
  status     OTPStatus @default(PENDING)
  user       User      @relation(fields: [user_id], references: [id])

  @@index([id, user_id, status])
}

model DMs {
  id              Int      @id @unique @default(autoincrement())
  users           Int[]
  message         String   @db.VarChar(255)
  status          DMStatus @default(PENDING)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  userId          Int?
  maxSize_number  Int      @default(5)
  maxSize_unit    String   @default("MB")
  maxUsers_number Int      @default(5)
  maxUsers_unit   String   @default("users")
  roomId          Int?
  rooms           Int
  uuid            String   @db.VarChar(255)
  room            rooms?   @relation(fields: [roomId], references: [id])
  user            User?    @relation(fields: [userId], references: [id])

  @@index([id, users, status, uuid])
}

model rooms {
  id              Int        @id @unique @default(autoincrement())
  users           Int[]
  uuid            String     @db.VarChar(255)
  type            type_rooms @default(DMS)
  maxSize_number  Int        @default(5)
  maxSize_unit    String     @default("MB")
  maxUsers_number Int        @default(5)
  maxUsers_unit   String     @default("users")
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  dms             DMs[]

  @@index([id, users, uuid])
}

model friends {
  id         Int           @id @unique @default(autoincrement())
  senderId   Int
  receiverId Int
  uuid       String        @db.VarChar(255)
  status     friendsStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sender   User  @relation("SentFriendRequests", fields: [senderId], references: [id])
  receiver User  @relation("ReceivedFriendRequests", fields: [receiverId], references: [id])
  user     User? @relation(fields: [userId], references: [id])
  userId   Int?

  @@unique([senderId, receiverId]) // Prevent duplicate friend requests
  @@index([id, senderId, receiverId, status, uuid])
}

enum Role {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BANNED
}

enum OTPStatus {
  PENDING
  VERIFIED
  EXPIRED
}

enum friendsStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum DMStatus {
  PENDING
  DELIVERED
  READ
}

enum type_rooms {
  DMS
  SERVER
}
